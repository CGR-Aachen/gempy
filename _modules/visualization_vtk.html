
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>visualization_vtk &#8212; GemPy 4 documentation</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '4',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for visualization_vtk</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">vtk</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="k">import</span> <span class="n">path</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="c1"># This is for sphenix to find the packages</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span> <span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span> <span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">gempy.colors</span> <span class="k">import</span> <span class="o">*</span>

<span class="k">def</span> <span class="nf">color_lot_create</span><span class="p">(</span><span class="n">geo_data</span><span class="p">,</span> <span class="n">cd_rgb</span><span class="o">=</span><span class="n">color_dict_rgb</span><span class="p">,</span> <span class="n">c_names</span><span class="o">=</span><span class="n">color_names</span><span class="p">,</span> <span class="n">c_subname</span><span class="o">=</span><span class="s2">&quot;400&quot;</span><span class="p">):</span>
    <span class="n">c_lot</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">fmt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">geo_data</span><span class="o">.</span><span class="n">formations</span><span class="p">):</span>
        <span class="n">c_lot</span><span class="p">[</span><span class="n">fmt</span><span class="p">]</span> <span class="o">=</span> <span class="n">cd_rgb</span><span class="p">[</span><span class="n">c_names</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="n">c_subname</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">c_lot</span>


<span class="k">class</span> <span class="nc">InterfaceSphere</span><span class="p">(</span><span class="n">vtk</span><span class="o">.</span><span class="n">vtkSphereSource</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">fmt</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index</span>  <span class="c1"># df index</span>
        <span class="k">if</span> <span class="n">fmt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">C_LOT</span><span class="p">[</span><span class="n">fmt</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">FoliationArrow</span><span class="p">(</span><span class="n">vtk</span><span class="o">.</span><span class="n">vtkArrowSource</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">fmt</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index</span>  <span class="c1"># df index</span>
        <span class="k">if</span> <span class="n">fmt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">C_LOT</span><span class="p">[</span><span class="n">fmt</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">ColoredActor</span><span class="p">(</span><span class="n">vtk</span><span class="o">.</span><span class="n">vtkActor</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span>


<span class="k">class</span> <span class="nc">CustomTransformPolyDataFilter</span><span class="p">(</span><span class="n">vtk</span><span class="o">.</span><span class="n">vtkTransformPolyDataFilter</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span>


<div class="viewcode-block" id="visualize"><a class="viewcode-back" href="../code.html#visualization_vtk.visualize">[docs]</a><span class="k">def</span> <span class="nf">visualize</span><span class="p">(</span><span class="n">geo_data</span><span class="p">,</span>
              <span class="n">pot_field</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">surface_vals</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">interf_bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fol_bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
              <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
              <span class="n">win_size</span><span class="o">=</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">800</span><span class="p">),</span>
              <span class="n">sphere_r</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">surface_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
              <span class="n">surface_spacing_modifier</span><span class="o">=</span><span class="mi">1</span>
              <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        geo_data: geo_data object</span>
<span class="sd">        pot_field: np.array</span>
<span class="sd">        surface_vals: list of potential field values</span>
<span class="sd">        interf_bool: bool</span>
<span class="sd">        fol_bool: bool</span>
<span class="sd">        surf_bool: bool</span>
<span class="sd">        verbose: int</span>

<span class="sd">    Returns:</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO: Fix move lock if window gets resized</span>
    <span class="k">global</span> <span class="n">C_LOT</span>  <span class="c1"># TODO: Make this more elegant, less shitty</span>
    <span class="n">C_LOT</span> <span class="o">=</span> <span class="n">color_lot_create</span><span class="p">(</span><span class="n">geo_data</span><span class="p">)</span>

    <span class="n">n_ren</span> <span class="o">=</span> <span class="mi">4</span>

    <span class="c1"># get model extent and calculate parameters for camera and sphere size</span>
    <span class="n">_e</span> <span class="o">=</span> <span class="n">geo_data</span><span class="o">.</span><span class="n">extent</span>  <span class="c1"># array([ x, X,  y, Y,  z, Z])</span>
    <span class="n">_e_dx</span> <span class="o">=</span> <span class="n">_e</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">_e</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">_e_dy</span> <span class="o">=</span> <span class="n">_e</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">_e</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">_e_dz</span> <span class="o">=</span> <span class="n">_e</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">-</span> <span class="n">_e</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
    <span class="n">_e_d_avrg</span> <span class="o">=</span> <span class="p">(</span><span class="n">_e_dx</span> <span class="o">+</span> <span class="n">_e_dy</span> <span class="o">+</span> <span class="n">_e_dz</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span>
    <span class="n">_e_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">geo_data</span><span class="o">.</span><span class="n">extent</span><span class="p">)</span>

    <span class="n">res</span> <span class="o">=</span> <span class="n">geo_data</span><span class="o">.</span><span class="n">resolution</span>

    <span class="c1"># create render window, settings</span>
    <span class="n">renwin</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkRenderWindow</span><span class="p">()</span>
    <span class="n">renwin</span><span class="o">.</span><span class="n">SetSize</span><span class="p">(</span><span class="n">win_size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">win_size</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">renwin</span><span class="o">.</span><span class="n">SetWindowName</span><span class="p">(</span><span class="s1">&#39;GeMpy 3D-Editor&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">interf_bool</span><span class="p">:</span>
        <span class="c1"># create interface SphereSource</span>
        <span class="k">if</span> <span class="n">sphere_r</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sphere_r</span> <span class="o">=</span> <span class="n">_e_d_avrg</span> <span class="o">/</span> <span class="mi">50</span>
        <span class="n">spheres</span> <span class="o">=</span> <span class="n">_create_interface_spheres</span><span class="p">(</span><span class="n">geo_data</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">sphere_r</span><span class="p">)</span>
        <span class="c1"># create sphere mappers and actors</span>
        <span class="n">interf_mappers</span><span class="p">,</span> <span class="n">interf_actors</span> <span class="o">=</span> <span class="n">_create_mappers_actors</span><span class="p">(</span><span class="n">spheres</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">fol_bool</span><span class="p">:</span>
        <span class="c1"># create foliation ArrowSource</span>
        <span class="n">arrows</span> <span class="o">=</span> <span class="n">_create_foliation_arrows</span><span class="p">(</span><span class="n">geo_data</span><span class="p">)</span>
        <span class="c1"># create arrow transformer</span>
        <span class="n">arrows_transformers</span> <span class="o">=</span> <span class="n">_create_arrow_transformers</span><span class="p">(</span><span class="n">arrows</span><span class="p">,</span> <span class="n">geo_data</span><span class="p">,</span> <span class="n">_e_d_avrg</span> <span class="o">/</span> <span class="mi">35</span><span class="p">)</span>
        <span class="c1"># create arrow mappers and actors</span>
        <span class="n">arrow_mappers</span><span class="p">,</span> <span class="n">arrow_actors</span> <span class="o">=</span> <span class="n">_create_mappers_actors</span><span class="p">(</span><span class="n">arrows_transformers</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">pot_field</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># create PolyData object for each surface</span>
        <span class="n">surfaces</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">surface_vals</span><span class="p">):</span>
            <span class="n">vertices</span><span class="p">,</span> <span class="n">simplices</span><span class="p">,</span> <span class="n">normals</span><span class="p">,</span> <span class="n">values</span> <span class="o">=</span> <span class="n">_extract_surface</span><span class="p">(</span><span class="n">pot_field</span><span class="p">,</span>
                                                                    <span class="n">val</span><span class="p">,</span>
                                                                    <span class="n">res</span><span class="p">,</span>
                                                                    <span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">surface_spacing_modifier</span><span class="p">,</span>
                                                                     <span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">surface_spacing_modifier</span><span class="p">,</span>
                                                                     <span class="n">res</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">surface_spacing_modifier</span><span class="p">))</span>
            <span class="n">_pf_p</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkPoints</span><span class="p">()</span>
            <span class="n">_pf_tris</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkCellArray</span><span class="p">()</span>
            <span class="n">_pf_tri</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkTriangle</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">vertices</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">simplices</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">simplices</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">vertices</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
                <span class="c1"># scale points with resolution and extent</span>
                <span class="c1"># TODO: Check correctness with other models</span>
                <span class="n">_p_temp</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="o">-</span><span class="p">(</span><span class="n">_e</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">_e</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">_e</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                           <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="o">-</span><span class="p">(</span><span class="n">_e</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">_e</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">/</span> <span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">_e</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                           <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="o">-</span><span class="p">(</span><span class="n">_e</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">-</span> <span class="n">_e</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span> <span class="o">/</span> <span class="n">res</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">_e</span><span class="p">[</span><span class="mi">4</span><span class="p">]]</span>
                <span class="n">_pf_p</span><span class="o">.</span><span class="n">InsertNextPoint</span><span class="p">(</span><span class="n">_p_temp</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">simplices</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
                <span class="n">_pf_tri</span><span class="o">.</span><span class="n">GetPointIds</span><span class="p">()</span><span class="o">.</span><span class="n">SetId</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">_pf_tri</span><span class="o">.</span><span class="n">GetPointIds</span><span class="p">()</span><span class="o">.</span><span class="n">SetId</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">_pf_tri</span><span class="o">.</span><span class="n">GetPointIds</span><span class="p">()</span><span class="o">.</span><span class="n">SetId</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

                <span class="n">_pf_tris</span><span class="o">.</span><span class="n">InsertNextCell</span><span class="p">(</span><span class="n">_pf_tri</span><span class="p">)</span>

            <span class="c1"># TODO: Hand down correct iso-surface colors for each layer interface</span>
            <span class="n">surfaces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CustomPolyData</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">C_LOT</span><span class="p">[</span><span class="n">geo_data</span><span class="o">.</span><span class="n">formations</span><span class="p">[</span><span class="n">c</span><span class="p">]],</span>
                                           <span class="n">surface_alpha</span><span class="o">=</span><span class="n">surface_alpha</span><span class="p">))</span>  <span class="c1"># vtk.vtkPolyData</span>
            <span class="n">surfaces</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">SetPoints</span><span class="p">(</span><span class="n">_pf_p</span><span class="p">)</span>
            <span class="n">surfaces</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">SetPolys</span><span class="p">(</span><span class="n">_pf_tris</span><span class="p">)</span>

        <span class="c1"># create surface mappers and actors</span>
        <span class="n">surface_mappers</span><span class="p">,</span> <span class="n">surface_actors</span> <span class="o">=</span> <span class="n">_create_mappers_actors</span><span class="p">(</span><span class="n">surfaces</span><span class="p">)</span>

    <span class="c1"># //////////////////////////////////////////////////////////////////////////////////////////////////////////////////</span>
    <span class="c1"># viewport dimensions setup</span>
    <span class="n">xmins</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">]</span>
    <span class="n">xmaxs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">ymins</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.33</span><span class="p">,</span> <span class="mf">0.66</span><span class="p">]</span>
    <span class="n">ymaxs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.33</span><span class="p">,</span> <span class="mf">0.66</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="c1"># create list of renderers, set vieport values</span>
    <span class="n">ren_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_ren</span><span class="p">):</span>
        <span class="c1"># append each renderer to list of renderers</span>
        <span class="n">ren_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vtk</span><span class="o">.</span><span class="n">vtkRenderer</span><span class="p">())</span>
        <span class="c1"># add each renderer to window</span>
        <span class="n">renwin</span><span class="o">.</span><span class="n">AddRenderer</span><span class="p">(</span><span class="n">ren_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="c1"># set viewport for each renderer</span>
        <span class="n">ren_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">SetViewport</span><span class="p">(</span><span class="n">xmins</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ymins</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">xmaxs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ymaxs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

    <span class="c1"># //////////////////////////////////////////////////////////////////////////////////////////////////////////////////</span>
    <span class="c1"># create interactor and set interactor style, assign render window</span>
    <span class="n">interactor</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkRenderWindowInteractor</span><span class="p">()</span>
    <span class="n">interactor</span><span class="o">.</span><span class="n">SetInteractorStyle</span><span class="p">(</span><span class="n">CustomInteractorCamera</span><span class="p">(</span><span class="n">ren_list</span><span class="p">,</span> <span class="n">geo_data</span><span class="p">,</span> <span class="n">interactor</span><span class="p">,</span> <span class="n">pot_field</span><span class="p">))</span>
    <span class="n">interactor</span><span class="o">.</span><span class="n">SetRenderWindow</span><span class="p">(</span><span class="n">renwin</span><span class="p">)</span>

    <span class="c1"># //////////////////////////////////////////////////////////////////////////////////////////////////////////////////</span>
    <span class="c1"># 3d model camera</span>
    <span class="n">camera_list</span> <span class="o">=</span> <span class="n">_create_cameras</span><span class="p">(</span><span class="n">_e</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="c1"># define background colors of the renderers</span>
    <span class="c1"># TODO: Tune renderer colors</span>
    <span class="c1"># TODO: Try to make renderer titles (floating text?!)</span>
    <span class="n">ren_color</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">66</span> <span class="o">/</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">66</span> <span class="o">/</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">66</span> <span class="o">/</span> <span class="mi">250</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_ren</span><span class="p">):</span>
        <span class="c1"># set active camera for each renderer</span>
        <span class="n">ren_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">SetActiveCamera</span><span class="p">(</span><span class="n">camera_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="c1"># set background color for each renderer</span>
        <span class="n">ren_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">SetBackground</span><span class="p">(</span><span class="n">ren_color</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">ren_color</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">ren_color</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>

    <span class="c1"># //////////////////////////////////////////////////////////////////////////////////////////////////////////////////</span>
    <span class="c1"># create AxesActor and customize</span>
    <span class="n">cube_axes_actor</span> <span class="o">=</span> <span class="n">_create_axes</span><span class="p">(</span><span class="n">geo_data</span><span class="p">,</span> <span class="n">camera_list</span><span class="p">)</span>

    <span class="c1"># add actors to all renderers</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">ren_list</span><span class="p">:</span>
        <span class="c1"># add axes actor to all renderers</span>
        <span class="n">r</span><span class="o">.</span><span class="n">AddActor</span><span class="p">(</span><span class="n">cube_axes_actor</span><span class="p">)</span>
        <span class="c1"># r.AddActor(axes_actor)</span>
        <span class="k">if</span> <span class="n">interf_bool</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">interf_actors</span><span class="p">:</span>
                <span class="n">r</span><span class="o">.</span><span class="n">AddActor</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fol_bool</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">arrow_actors</span><span class="p">:</span>
                <span class="n">r</span><span class="o">.</span><span class="n">AddActor</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pot_field</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">surface_actors</span><span class="p">:</span>
                <span class="n">r</span><span class="o">.</span><span class="n">AddActor</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

        <span class="c1"># reset cameras for all renderers</span>
        <span class="n">r</span><span class="o">.</span><span class="n">ResetCamera</span><span class="p">()</span>

    <span class="c1"># initialize and start the app</span>
    <span class="n">interactor</span><span class="o">.</span><span class="n">Initialize</span><span class="p">()</span>
    <span class="n">interactor</span><span class="o">.</span><span class="n">Start</span><span class="p">()</span>

    <span class="c1"># close_window(interactor)</span>
    <span class="k">del</span> <span class="n">renwin</span><span class="p">,</span> <span class="n">interactor</span></div>


<span class="k">def</span> <span class="nf">_extract_surface</span><span class="p">(</span><span class="n">pot_field</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">spacing</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">skimage</span> <span class="k">import</span> <span class="n">measure</span>

    <span class="n">vertices</span><span class="p">,</span> <span class="n">simplices</span><span class="p">,</span> <span class="n">normals</span><span class="p">,</span> <span class="n">values</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">marching_cubes</span><span class="p">(</span><span class="n">pot_field</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
                                                                  <span class="n">val</span>  <span class="c1"># , #0.2424792,  # -0.559606</span>
                                                                  <span class="c1"># spacing=spacing, # (10.0, 10.0, 10.0)</span>
                                                                  <span class="p">)</span>
    <span class="k">return</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">simplices</span><span class="p">,</span> <span class="n">normals</span><span class="p">,</span> <span class="n">values</span>


<span class="k">def</span> <span class="nf">_create_cameras</span><span class="p">(</span><span class="n">_e</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="n">_e_dx</span> <span class="o">=</span> <span class="n">_e</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">_e</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">_e_dy</span> <span class="o">=</span> <span class="n">_e</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">_e</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">_e_dz</span> <span class="o">=</span> <span class="n">_e</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">-</span> <span class="n">_e</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
    <span class="n">_e_d_avrg</span> <span class="o">=</span> <span class="p">(</span><span class="n">_e_dx</span> <span class="o">+</span> <span class="n">_e_dy</span> <span class="o">+</span> <span class="n">_e_dz</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span>
    <span class="n">_e_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">_e</span><span class="p">)</span>

    <span class="n">model_cam</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkCamera</span><span class="p">()</span>
    <span class="n">model_cam</span><span class="o">.</span><span class="n">SetPosition</span><span class="p">(</span><span class="n">_e</span><span class="p">[</span><span class="n">_e_max</span><span class="p">]</span> <span class="o">*</span> <span class="mi">5</span><span class="p">,</span> <span class="n">_e</span><span class="p">[</span><span class="n">_e_max</span><span class="p">]</span> <span class="o">*</span> <span class="mi">5</span><span class="p">,</span> <span class="n">_e</span><span class="p">[</span><span class="n">_e_max</span><span class="p">]</span> <span class="o">*</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">model_cam</span><span class="o">.</span><span class="n">SetFocalPoint</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">_e</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="n">_e_dx</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">_e</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">])</span> <span class="o">+</span> <span class="n">_e_dy</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">_e</span><span class="p">[</span><span class="mi">4</span><span class="p">:])</span> <span class="o">+</span> <span class="n">_e_dz</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">model_cam</span><span class="o">.</span><span class="n">SetViewUp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.239</span><span class="p">,</span><span class="mf">0.155</span><span class="p">,</span><span class="mf">0.958</span><span class="p">)</span>
    <span class="c1">#model_cam.Roll(-80.)</span>

    <span class="c1"># XY camera RED</span>
    <span class="n">xy_cam</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkCamera</span><span class="p">()</span>
    <span class="c1"># if np.argmin(_e[4:]) == 0:</span>
    <span class="n">xy_cam</span><span class="o">.</span><span class="n">SetPosition</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">_e</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="n">_e_dx</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                       <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">_e</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">])</span> <span class="o">+</span> <span class="n">_e_dy</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                       <span class="n">_e</span><span class="p">[</span><span class="n">_e_max</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>

    <span class="n">xy_cam</span><span class="o">.</span><span class="n">SetFocalPoint</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">_e</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="n">_e_dx</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                         <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">_e</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">])</span> <span class="o">+</span> <span class="n">_e_dy</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                         <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">_e</span><span class="p">[</span><span class="mi">4</span><span class="p">:])</span> <span class="o">+</span> <span class="n">_e_dz</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

    <span class="c1"># YZ camera GREEN</span>
    <span class="n">yz_cam</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkCamera</span><span class="p">()</span>
    <span class="n">yz_cam</span><span class="o">.</span><span class="n">SetPosition</span><span class="p">(</span><span class="n">_e</span><span class="p">[</span><span class="n">_e_max</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span>
                       <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">_e</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">])</span> <span class="o">+</span> <span class="n">_e_dy</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                       <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">_e</span><span class="p">[</span><span class="mi">4</span><span class="p">:])</span> <span class="o">+</span> <span class="n">_e_dz</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">yz_cam</span><span class="o">.</span><span class="n">SetFocalPoint</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">_e</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="n">_e_dx</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                         <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">_e</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">])</span> <span class="o">+</span> <span class="n">_e_dy</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                         <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">_e</span><span class="p">[</span><span class="mi">4</span><span class="p">:])</span> <span class="o">+</span> <span class="n">_e_dz</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">yz_cam</span><span class="o">.</span><span class="n">Roll</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">)</span>

    <span class="c1"># XZ camera BLUE</span>
    <span class="n">xz_cam</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkCamera</span><span class="p">()</span>
    <span class="n">xz_cam</span><span class="o">.</span><span class="n">SetPosition</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">_e</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="n">_e_dx</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                       <span class="n">_e</span><span class="p">[</span><span class="n">_e_max</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span>
                       <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">_e</span><span class="p">[</span><span class="mi">4</span><span class="p">:])</span> <span class="o">+</span> <span class="n">_e_dz</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">xz_cam</span><span class="o">.</span><span class="n">SetFocalPoint</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">_e</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="n">_e_dx</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                         <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">_e</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">])</span> <span class="o">+</span> <span class="n">_e_dy</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                         <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">_e</span><span class="p">[</span><span class="mi">4</span><span class="p">:])</span> <span class="o">+</span> <span class="n">_e_dz</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">xz_cam</span><span class="o">.</span><span class="n">SetViewUp</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">xz_cam</span><span class="o">.</span><span class="n">Roll</span><span class="p">(</span><span class="mi">90</span><span class="p">)</span>

    <span class="c1"># camera position debugging</span>
    <span class="k">if</span> <span class="n">verbose</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;RED XY:&quot;</span><span class="p">,</span> <span class="n">xy_cam</span><span class="o">.</span><span class="n">GetPosition</span><span class="p">())</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;RED FP:&quot;</span><span class="p">,</span> <span class="n">xy_cam</span><span class="o">.</span><span class="n">GetFocalPoint</span><span class="p">())</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;GREEN YZ:&quot;</span><span class="p">,</span> <span class="n">yz_cam</span><span class="o">.</span><span class="n">GetPosition</span><span class="p">())</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;GREEN FP:&quot;</span><span class="p">,</span> <span class="n">yz_cam</span><span class="o">.</span><span class="n">GetFocalPoint</span><span class="p">())</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;BLUE XZ:&quot;</span><span class="p">,</span> <span class="n">xz_cam</span><span class="o">.</span><span class="n">GetPosition</span><span class="p">())</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;BLUE FP:&quot;</span><span class="p">,</span> <span class="n">xz_cam</span><span class="o">.</span><span class="n">GetFocalPoint</span><span class="p">())</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">model_cam</span><span class="p">,</span> <span class="n">xy_cam</span><span class="p">,</span> <span class="n">yz_cam</span><span class="p">,</span> <span class="n">xz_cam</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">_create_interface_spheres</span><span class="p">(</span><span class="n">geo_data</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mf">0.33</span><span class="p">):</span>
    <span class="s2">&quot;Creates InterfaceSphere (vtkSphereSource) for all interface positions in dataframe.&quot;</span>
    <span class="n">spheres</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">geo_data</span><span class="o">.</span><span class="n">interfaces</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">spheres</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">InterfaceSphere</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="n">geo_data</span><span class="o">.</span><span class="n">interfaces</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s2">&quot;formation&quot;</span><span class="p">]))</span>
        <span class="n">spheres</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">SetCenter</span><span class="p">(</span><span class="n">geo_data</span><span class="o">.</span><span class="n">interfaces</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s2">&quot;X&quot;</span><span class="p">],</span>
                              <span class="n">geo_data</span><span class="o">.</span><span class="n">interfaces</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s2">&quot;Y&quot;</span><span class="p">],</span>
                              <span class="n">geo_data</span><span class="o">.</span><span class="n">interfaces</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s2">&quot;Z&quot;</span><span class="p">])</span>
        <span class="n">spheres</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">SetRadius</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">spheres</span>


<span class="k">def</span> <span class="nf">_create_foliation_arrows</span><span class="p">(</span><span class="n">geo_data</span><span class="p">):</span>
    <span class="s2">&quot;Creates FoliationArrow (vtkArrowSource) for all foliation positions in dataframe.&quot;</span>
    <span class="n">arrows</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">geo_data</span><span class="o">.</span><span class="n">foliations</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">arrows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">FoliationArrow</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="n">geo_data</span><span class="o">.</span><span class="n">interfaces</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s2">&quot;formation&quot;</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">arrows</span>


<span class="k">def</span> <span class="nf">_create_mappers_actors</span><span class="p">(</span><span class="n">sources</span><span class="p">):</span>
    <span class="s2">&quot;Creates mappers and connected actors for all given sources.&quot;</span>
    <span class="n">mappers</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">actors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sources</span><span class="p">:</span>
        <span class="n">mappers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vtk</span><span class="o">.</span><span class="n">vtkPolyDataMapper</span><span class="p">())</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="n">CustomPolyData</span><span class="p">:</span>
            <span class="n">mappers</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">SetInputData</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="n">actors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ColoredSurfaceActor</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">color</span><span class="p">))</span>

            <span class="n">actors</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">()</span><span class="o">.</span><span class="n">SetColor</span><span class="p">(</span><span class="n">actors</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">color</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">actors</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">color</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">actors</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">color</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">actors</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">()</span><span class="o">.</span><span class="n">SetOpacity</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">surface_alpha</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mappers</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">SetInputConnection</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">GetOutputPort</span><span class="p">())</span>
            <span class="n">actors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ColoredActor</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">color</span><span class="p">))</span>

            <span class="n">actors</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">()</span><span class="o">.</span><span class="n">SetColor</span><span class="p">(</span><span class="n">actors</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">color</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">actors</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">color</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">actors</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">color</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">actors</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">SetMapper</span><span class="p">(</span><span class="n">mappers</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">mappers</span><span class="p">,</span> <span class="n">actors</span>


<span class="k">class</span> <span class="nc">CustomPolyData</span><span class="p">(</span><span class="n">vtk</span><span class="o">.</span><span class="n">vtkPolyData</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">surface_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">surface_alpha</span> <span class="o">=</span> <span class="n">surface_alpha</span>


<span class="k">class</span> <span class="nc">ColoredSurfaceActor</span><span class="p">(</span><span class="n">vtk</span><span class="o">.</span><span class="n">vtkActor</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">surface_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">surface_alpha</span> <span class="o">=</span> <span class="n">surface_alpha</span>


<span class="k">def</span> <span class="nf">_get_transform</span><span class="p">(</span><span class="n">startPoint</span><span class="p">,</span> <span class="n">endPoint</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
    <span class="c1"># Compute a basis</span>
    <span class="n">normalized_x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
    <span class="n">normalized_y</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
    <span class="n">normalized_z</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>

    <span class="c1"># The X axis is a vector from start to end</span>
    <span class="n">math</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkMath</span><span class="p">()</span>
    <span class="n">math</span><span class="o">.</span><span class="n">Subtract</span><span class="p">(</span><span class="n">endPoint</span><span class="p">,</span> <span class="n">startPoint</span><span class="p">,</span> <span class="n">normalized_x</span><span class="p">)</span>
    <span class="n">length</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">Norm</span><span class="p">(</span><span class="n">normalized_x</span><span class="p">)</span>
    <span class="n">math</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">normalized_x</span><span class="p">)</span>

    <span class="c1"># The Z axis is an arbitrary vector cross X</span>
    <span class="n">arbitrary</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
    <span class="n">arbitrary</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">arbitrary</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">arbitrary</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">math</span><span class="o">.</span><span class="n">Cross</span><span class="p">(</span><span class="n">normalized_x</span><span class="p">,</span> <span class="n">arbitrary</span><span class="p">,</span> <span class="n">normalized_z</span><span class="p">)</span>
    <span class="n">math</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">normalized_z</span><span class="p">)</span>

    <span class="c1"># The Y axis is Z cross X</span>
    <span class="n">math</span><span class="o">.</span><span class="n">Cross</span><span class="p">(</span><span class="n">normalized_z</span><span class="p">,</span> <span class="n">normalized_x</span><span class="p">,</span> <span class="n">normalized_y</span><span class="p">)</span>
    <span class="n">matrix</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkMatrix4x4</span><span class="p">()</span>

    <span class="c1"># Create the direction cosine matrix</span>
    <span class="n">matrix</span><span class="o">.</span><span class="n">Identity</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">matrix</span><span class="o">.</span><span class="n">SetElement</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">normalized_x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">matrix</span><span class="o">.</span><span class="n">SetElement</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">normalized_y</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">matrix</span><span class="o">.</span><span class="n">SetElement</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">normalized_z</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

    <span class="c1"># Apply the transforms</span>
    <span class="n">transform</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkTransform</span><span class="p">()</span>
    <span class="n">transform</span><span class="o">.</span><span class="n">Translate</span><span class="p">(</span><span class="n">startPoint</span><span class="p">)</span>
    <span class="n">transform</span><span class="o">.</span><span class="n">Concatenate</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>
    <span class="n">transform</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">length</span> <span class="o">*</span> <span class="n">f</span><span class="p">,</span> <span class="n">length</span> <span class="o">*</span> <span class="n">f</span><span class="p">,</span> <span class="n">length</span> <span class="o">*</span> <span class="n">f</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">transform</span>


<span class="k">def</span> <span class="nf">_create_arrow_transformers</span><span class="p">(</span><span class="n">arrows</span><span class="p">,</span> <span class="n">geo_data</span><span class="p">,</span> <span class="n">f2</span><span class="p">):</span>
    <span class="s2">&quot;Creates list of arrow transformation objects.&quot;</span>
    <span class="c1"># grab start and end points for foliation arrows</span>
    <span class="n">arrows_sp</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">arrows_ep</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">f</span> <span class="o">=</span> <span class="mf">0.75</span>
    <span class="k">for</span> <span class="n">arrow</span> <span class="ow">in</span> <span class="n">arrows</span><span class="p">:</span>
        <span class="n">_sp</span> <span class="o">=</span> <span class="p">(</span><span class="n">geo_data</span><span class="o">.</span><span class="n">foliations</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">arrow</span><span class="o">.</span><span class="n">index</span><span class="p">][</span><span class="s2">&quot;X&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">geo_data</span><span class="o">.</span><span class="n">foliations</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">arrow</span><span class="o">.</span><span class="n">index</span><span class="p">][</span><span class="s2">&quot;G_x&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">f</span><span class="p">,</span>
               <span class="n">geo_data</span><span class="o">.</span><span class="n">foliations</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">arrow</span><span class="o">.</span><span class="n">index</span><span class="p">][</span><span class="s2">&quot;Y&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">geo_data</span><span class="o">.</span><span class="n">foliations</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">arrow</span><span class="o">.</span><span class="n">index</span><span class="p">][</span><span class="s2">&quot;G_x&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">f</span><span class="p">,</span>
               <span class="n">geo_data</span><span class="o">.</span><span class="n">foliations</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">arrow</span><span class="o">.</span><span class="n">index</span><span class="p">][</span><span class="s2">&quot;Z&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">geo_data</span><span class="o">.</span><span class="n">foliations</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">arrow</span><span class="o">.</span><span class="n">index</span><span class="p">][</span><span class="s2">&quot;G_x&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">f</span><span class="p">)</span>
        <span class="n">_ep</span> <span class="o">=</span> <span class="p">(</span><span class="n">geo_data</span><span class="o">.</span><span class="n">foliations</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">arrow</span><span class="o">.</span><span class="n">index</span><span class="p">][</span><span class="s2">&quot;X&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">geo_data</span><span class="o">.</span><span class="n">foliations</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">arrow</span><span class="o">.</span><span class="n">index</span><span class="p">][</span><span class="s2">&quot;G_x&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">f</span><span class="p">,</span>
               <span class="n">geo_data</span><span class="o">.</span><span class="n">foliations</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">arrow</span><span class="o">.</span><span class="n">index</span><span class="p">][</span><span class="s2">&quot;Y&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">geo_data</span><span class="o">.</span><span class="n">foliations</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">arrow</span><span class="o">.</span><span class="n">index</span><span class="p">][</span><span class="s2">&quot;G_y&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">f</span><span class="p">,</span>
               <span class="n">geo_data</span><span class="o">.</span><span class="n">foliations</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">arrow</span><span class="o">.</span><span class="n">index</span><span class="p">][</span><span class="s2">&quot;Z&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">geo_data</span><span class="o">.</span><span class="n">foliations</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">arrow</span><span class="o">.</span><span class="n">index</span><span class="p">][</span><span class="s2">&quot;G_z&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">f</span><span class="p">)</span>
        <span class="n">arrows_sp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_sp</span><span class="p">)</span>
        <span class="n">arrows_ep</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_ep</span><span class="p">)</span>

    <span class="c1"># ///////////////////////////////////////////////////////////////</span>
    <span class="c1"># create transformers for ArrowSource and transform</span>

    <span class="n">arrows_transformers</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">arrow</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arrows</span><span class="p">):</span>
        <span class="n">arrows_transformers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CustomTransformPolyDataFilter</span><span class="p">(</span><span class="n">arrow</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">arrow</span><span class="o">.</span><span class="n">color</span><span class="p">))</span>
        <span class="n">arrows_transformers</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">SetTransform</span><span class="p">(</span><span class="n">_get_transform</span><span class="p">(</span><span class="n">arrows_sp</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">arrows_ep</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">f2</span><span class="p">))</span>
        <span class="n">arrows_transformers</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">SetInputConnection</span><span class="p">(</span><span class="n">arrow</span><span class="o">.</span><span class="n">GetOutputPort</span><span class="p">())</span>

    <span class="k">return</span> <span class="n">arrows_transformers</span>


<span class="k">def</span> <span class="nf">_create_axes</span><span class="p">(</span><span class="n">geo_data</span><span class="p">,</span> <span class="n">camera_list</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="s2">&quot;Create and returnr cubeAxesActor, settings.&quot;</span>
    <span class="n">cube_axes_actor</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkCubeAxesActor</span><span class="p">()</span>
    <span class="n">cube_axes_actor</span><span class="o">.</span><span class="n">SetBounds</span><span class="p">(</span><span class="n">geo_data</span><span class="o">.</span><span class="n">extent</span><span class="p">)</span>
    <span class="n">cube_axes_actor</span><span class="o">.</span><span class="n">SetCamera</span><span class="p">(</span><span class="n">camera_list</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">verbose</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">cube_axes_actor</span><span class="o">.</span><span class="n">GetAxisOrigin</span><span class="p">())</span>

    <span class="c1"># set axes and label colors</span>
    <span class="n">cube_axes_actor</span><span class="o">.</span><span class="n">GetTitleTextProperty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">SetColor</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="n">cube_axes_actor</span><span class="o">.</span><span class="n">GetLabelTextProperty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">SetColor</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="c1"># font size doesn&#39;t work seem to work - maybe some override in place?</span>
    <span class="c1"># cubeAxesActor.GetLabelTextProperty(0).SetFontSize(10)</span>
    <span class="n">cube_axes_actor</span><span class="o">.</span><span class="n">GetTitleTextProperty</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">SetColor</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="n">cube_axes_actor</span><span class="o">.</span><span class="n">GetLabelTextProperty</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">SetColor</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="n">cube_axes_actor</span><span class="o">.</span><span class="n">GetTitleTextProperty</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">SetColor</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="n">cube_axes_actor</span><span class="o">.</span><span class="n">GetLabelTextProperty</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">SetColor</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="n">cube_axes_actor</span><span class="o">.</span><span class="n">DrawXGridlinesOn</span><span class="p">()</span>
    <span class="n">cube_axes_actor</span><span class="o">.</span><span class="n">DrawYGridlinesOn</span><span class="p">()</span>
    <span class="n">cube_axes_actor</span><span class="o">.</span><span class="n">DrawZGridlinesOn</span><span class="p">()</span>

    <span class="n">cube_axes_actor</span><span class="o">.</span><span class="n">XAxisMinorTickVisibilityOff</span><span class="p">()</span>
    <span class="n">cube_axes_actor</span><span class="o">.</span><span class="n">YAxisMinorTickVisibilityOff</span><span class="p">()</span>
    <span class="n">cube_axes_actor</span><span class="o">.</span><span class="n">ZAxisMinorTickVisibilityOff</span><span class="p">()</span>

    <span class="n">cube_axes_actor</span><span class="o">.</span><span class="n">SetXTitle</span><span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">)</span>
    <span class="n">cube_axes_actor</span><span class="o">.</span><span class="n">SetYTitle</span><span class="p">(</span><span class="s2">&quot;Y&quot;</span><span class="p">)</span>
    <span class="n">cube_axes_actor</span><span class="o">.</span><span class="n">SetZTitle</span><span class="p">(</span><span class="s2">&quot;Z&quot;</span><span class="p">)</span>

    <span class="n">cube_axes_actor</span><span class="o">.</span><span class="n">SetXAxisLabelVisibility</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">cube_axes_actor</span><span class="o">.</span><span class="n">SetYAxisLabelVisibility</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">cube_axes_actor</span><span class="o">.</span><span class="n">SetZAxisLabelVisibility</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># only plot grid lines furthest from viewpoint</span>
    <span class="c1"># ensure platform compatibility for the grid line options</span>
    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s2">&quot;win32&quot;</span><span class="p">:</span>
        <span class="n">cube_axes_actor</span><span class="o">.</span><span class="n">SetGridLineLocation</span><span class="p">(</span><span class="n">cube_axes_actor</span><span class="o">.</span><span class="n">VTK_GRID_LINES_FURTHEST</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># rather use elif == &quot;linux&quot; ? but what about other platforms</span>
        <span class="n">cube_axes_actor</span><span class="o">.</span><span class="n">SetGridLineLocation</span><span class="p">(</span><span class="n">vtk</span><span class="o">.</span><span class="n">VTK_GRID_LINES_FURTHEST</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cube_axes_actor</span>


<div class="viewcode-block" id="export_vtk_rectilinear"><a class="viewcode-back" href="../code.html#visualization_vtk.export_vtk_rectilinear">[docs]</a><span class="k">def</span> <span class="nf">export_vtk_rectilinear</span><span class="p">(</span><span class="n">geo_data</span><span class="p">,</span> <span class="n">block_lith</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        export vtk</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="kn">from</span> <span class="nn">evtk.hl</span> <span class="k">import</span> <span class="n">gridToVTK</span>

    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

    <span class="kn">import</span> <span class="nn">random</span> <span class="k">as</span> <span class="nn">rnd</span>

    <span class="c1"># Dimensions</span>

    <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">nz</span> <span class="o">=</span> <span class="n">geo_data</span><span class="o">.</span><span class="n">resolution</span>

    <span class="n">lx</span> <span class="o">=</span> <span class="n">geo_data</span><span class="o">.</span><span class="n">extent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">geo_data</span><span class="o">.</span><span class="n">extent</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">ly</span> <span class="o">=</span> <span class="n">geo_data</span><span class="o">.</span><span class="n">extent</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">geo_data</span><span class="o">.</span><span class="n">extent</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">lz</span> <span class="o">=</span> <span class="n">geo_data</span><span class="o">.</span><span class="n">extent</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">-</span> <span class="n">geo_data</span><span class="o">.</span><span class="n">extent</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>

    <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dz</span> <span class="o">=</span> <span class="n">lx</span> <span class="o">/</span> <span class="n">nx</span><span class="p">,</span> <span class="n">ly</span> <span class="o">/</span> <span class="n">ny</span><span class="p">,</span> <span class="n">lz</span> <span class="o">/</span> <span class="n">nz</span>

    <span class="n">ncells</span> <span class="o">=</span> <span class="n">nx</span> <span class="o">*</span> <span class="n">ny</span> <span class="o">*</span> <span class="n">nz</span>

    <span class="n">npoints</span> <span class="o">=</span> <span class="p">(</span><span class="n">nx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">ny</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">nz</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Coordinates</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">lx</span> <span class="o">+</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>

    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ly</span> <span class="o">+</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>

    <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">lz</span> <span class="o">+</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">dz</span><span class="p">,</span> <span class="n">dz</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>

    <span class="c1"># Variables</span>

    <span class="n">lith</span> <span class="o">=</span> <span class="n">block_lith</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">nz</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;./Lithology_block&quot;</span>

    <span class="n">gridToVTK</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">cellData</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Lithology&quot;</span><span class="p">:</span> <span class="n">lith</span><span class="p">})</span></div>


<div class="viewcode-block" id="CustomInteractorActor"><a class="viewcode-back" href="../code.html#visualization_vtk.CustomInteractorActor">[docs]</a><span class="k">class</span> <span class="nc">CustomInteractorActor</span><span class="p">(</span><span class="n">vtk</span><span class="o">.</span><span class="n">vtkInteractorStyleTrackballActor</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Modified vtkInteractorStyleTrackballActor class to accomodate for interface df modifications.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ren_list</span><span class="p">,</span> <span class="n">geo_data</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">On</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DebugOn</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren_list</span> <span class="o">=</span> <span class="n">ren_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">geo_data</span> <span class="o">=</span> <span class="n">geo_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span><span class="s2">&quot;MiddleButtonPressEvent&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">middle_button_press_event</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span><span class="s2">&quot;MiddleButtonReleaseEvent&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">middle_button_release_event</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span><span class="s2">&quot;LeftButtonPressEvent&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_button_press_event</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span><span class="s2">&quot;LeftButtonReleaseEvent&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_button_release_event</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span><span class="s2">&quot;KeyPressEvent&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_down_event</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span><span class="s2">&quot;MouseMoveEvent&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouse_move_event</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">PickedActor</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PickedProducer</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">key_down_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="n">iren</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetInteractor</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">iren</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">key</span> <span class="o">=</span> <span class="n">iren</span><span class="o">.</span><span class="n">GetKeyCode</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;5&quot;</span><span class="p">:</span>  <span class="c1"># switch to other renderer</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">SetInteractorStyle</span><span class="p">(</span><span class="n">CustomInteractorCamera</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ren_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geo_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">))</span>

        <span class="c1"># elif key == &quot;d&quot;:</span>
        <span class="c1">#     mouse_pos = self.GetInteractor().GetEventPosition()</span>
        <span class="c1">#     pickers = []</span>
        <span class="c1">#     picked_actors = []</span>
        <span class="c1">#     for r in self.ren_list:</span>
        <span class="c1">#         pickers.append(vtk.vtkPicker())</span>
        <span class="c1">#         pickers[-1].Pick(mouse_pos[0], mouse_pos[1], 0, r)</span>
        <span class="c1">#         picked_actors.append(pickers[-1].GetActor())</span>
        <span class="c1">#     for pa in picked_actors:</span>
        <span class="c1">#         if pa is not None:</span>
        <span class="c1">#             _m = pa.GetMapper()</span>
        <span class="c1">#             _i = _m.GetInputConnection(0, 0)</span>
        <span class="c1">#             _p = _i.GetProducer()</span>
        <span class="c1">#</span>
        <span class="c1">#             if type(_p) is InterfaceSphere:</span>
        <span class="c1">#                 self.geo_data.interface_drop(_p.index)</span>
        <span class="c1">#</span>
        <span class="c1">#             elif type(_p) is FoliationArrow:</span>
        <span class="c1">#                 alg = _p.GetInputConnection(0, 0)</span>
        <span class="c1">#                 self.geo_data.foliation_drop(_p)</span>
        <span class="c1">#                 _p = alg.GetProducer()</span>
        <span class="c1">#         for r in self.ren_list:</span>
        <span class="c1">#             r.RemoveActor(pa)</span>
        <span class="c1">#             r.Render()</span>
        <span class="c1"># # TODO: Make point deletion work.</span>



    <span class="k">def</span> <span class="nf">left_button_press_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="c1">#self.middle_button_press_event(obj, event)</span>
        <span class="k">pass</span>
        <span class="c1"># # print(&quot;Pressed left mouse button&quot;)</span>
        <span class="c1">#</span>
        <span class="c1"># # m = vtk.vtkMatrix4x4()</span>
        <span class="c1">#</span>
        <span class="c1"># clickPos = self.GetInteractor().GetEventPosition()</span>
        <span class="c1"># pickers = []</span>
        <span class="c1"># picked_actors = []</span>
        <span class="c1"># for r in self.ren_list:</span>
        <span class="c1">#     pickers.append(vtk.vtkPicker())</span>
        <span class="c1">#     pickers[-1].Pick(clickPos[0], clickPos[1], 0, r)</span>
        <span class="c1">#     picked_actors.append(pickers[-1].GetActor())</span>
        <span class="c1"># for pa in picked_actors:</span>
        <span class="c1">#     if pa is not None:</span>
        <span class="c1">#         self.PickedActor = pa</span>
        <span class="c1">#</span>
        <span class="c1"># # TODO: Arrow Rotation -&gt; modify foliation dataframe</span>
        <span class="c1"># # vtk.vtkOpenGLActor.GetOrientation?</span>
        <span class="c1"># # matrix = self.PickedActor.GetMatrix(m)</span>
        <span class="c1"># # if self.PickedActor is</span>
        <span class="c1"># # self.PickedActor.SetScale(2)</span>
        <span class="c1"># # renwin.Render()</span>
        <span class="c1"># #try:</span>
        <span class="c1"># #    orientation = self.PickedActor.GetOrientation()</span>
        <span class="c1"># #    print(str(orientation))</span>
        <span class="c1"># #except AttributeError:</span>
        <span class="c1"># #    pass</span>
        <span class="c1">#</span>
        <span class="c1"># self.OnLeftButtonDown()</span>

    <span class="k">def</span> <span class="nf">left_button_release_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="c1">#self.middle_button_release_event(obj, event)</span>
        <span class="k">pass</span>
        <span class="c1"># # matrix = self.PickedActor.GetMatrix(vtk.vtkMatrix4x4())</span>
        <span class="c1"># try:</span>
        <span class="c1">#     matrix = self.PickedActor.GetOrientation()</span>
        <span class="c1">#     # print(str(matrix))</span>
        <span class="c1"># except AttributeError:</span>
        <span class="c1">#     pass</span>
        <span class="c1"># self.OnLeftButtonUp()</span>

    <span class="k">def</span> <span class="nf">middle_button_press_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="c1"># get event position of click event</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">PickedProducer</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PickedActor</span> <span class="o">=</span> <span class="kc">None</span>


        <span class="n">clickPos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetInteractor</span><span class="p">()</span><span class="o">.</span><span class="n">GetEventPosition</span><span class="p">()</span>

        <span class="n">pickers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">picked_actors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># go through every renderer and pick</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ren_list</span><span class="p">:</span>
            <span class="n">pickers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vtk</span><span class="o">.</span><span class="n">vtkPicker</span><span class="p">())</span>
            <span class="n">pickers</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">Pick</span><span class="p">(</span><span class="n">clickPos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">clickPos</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
            <span class="n">picked_actors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pickers</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">GetActor</span><span class="p">())</span>

        <span class="c1"># select the actual actor picked (if exists)</span>
        <span class="k">for</span> <span class="n">pa</span> <span class="ow">in</span> <span class="n">picked_actors</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pa</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PickedActor</span> <span class="o">=</span> <span class="n">pa</span>
                <span class="c1">#self.PickedActor.Update()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">PickedActor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PickedActor</span><span class="o">.</span><span class="n">GetMapper</span><span class="p">()</span>
            <span class="n">_i</span> <span class="o">=</span> <span class="n">_m</span><span class="o">.</span><span class="n">GetInputConnection</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">_p</span> <span class="o">=</span> <span class="n">_i</span><span class="o">.</span><span class="n">GetProducer</span><span class="p">()</span>

            <span class="c1">#print(type(_p))</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">_p</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">InterfaceSphere</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">_p</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">CustomTransformPolyDataFilter</span> <span class="ow">and</span> <span class="n">_p</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># then go deeper</span>
            <span class="n">alg</span> <span class="o">=</span> <span class="n">_p</span><span class="o">.</span><span class="n">GetInputConnection</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PickedProducer</span> <span class="o">=</span> <span class="n">alg</span><span class="o">.</span><span class="n">GetProducer</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PickedProducer</span> <span class="o">=</span> <span class="n">_p</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">PickedProducer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># print(&quot;Moving actor: &quot;,type(self.PickedActor))</span>
                <span class="c1"># print(&quot;Producer: &quot;,type(self.PickedProducer))</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PickedProducer</span><span class="p">)</span> <span class="ow">is</span> <span class="n">InterfaceSphere</span><span class="p">:</span>
                    <span class="n">_c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PickedActor</span><span class="o">.</span><span class="n">GetCenter</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">geo_data</span><span class="o">.</span><span class="n">interface_modify</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PickedProducer</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">_c</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Y</span><span class="o">=</span><span class="n">_c</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Z</span><span class="o">=</span><span class="n">_c</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PickedProducer</span><span class="p">)</span> <span class="ow">is</span> <span class="n">CustomTransformPolyDataFilter</span><span class="p">:</span>
                    <span class="n">_c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PickedActor</span><span class="o">.</span><span class="n">GetCenter</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">geo_data</span><span class="o">.</span><span class="n">foliation_modify</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PickedProducer</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">_c</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Y</span><span class="o">=</span><span class="n">_c</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Z</span><span class="o">=</span><span class="n">_c</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>


            <span class="c1"># print(str(type(self.PickedProducer)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">OnMiddleButtonDown</span><span class="p">()</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">mouse_move_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">OnMouseMove</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">middle_button_release_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="c1"># TODO: disable moving surfaces</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">PickedProducer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1">#print(&quot;Moving actor: &quot;,type(self.PickedActor))</span>
            <span class="c1">#print(&quot;Producer: &quot;,type(self.PickedProducer))</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PickedProducer</span><span class="p">)</span> <span class="ow">is</span> <span class="n">InterfaceSphere</span><span class="p">:</span>
                <span class="c1"># if self.PickedActor.GetPosition() == (0.0, 0.0, 0.0):</span>
                <span class="c1">#     pr = &#39;The point &#39; + str(self.PickedProducer.index) + &#39; did not move. Click on it again&#39;</span>
                <span class="c1"># else:</span>
                <span class="c1">#     pr = &#39;The point &#39; + str(self.PickedProducer.index) + &#39; moved.&#39;</span>
                <span class="c1"># print(&quot;MiddleMouseButton released. &quot;, pr)</span>
                <span class="n">_c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PickedActor</span><span class="o">.</span><span class="n">GetCenter</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">geo_data</span><span class="o">.</span><span class="n">interface_modify</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PickedProducer</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">_c</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Y</span><span class="o">=</span><span class="n">_c</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Z</span><span class="o">=</span><span class="n">_c</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PickedProducer</span><span class="p">)</span> <span class="ow">is</span> <span class="n">CustomTransformPolyDataFilter</span><span class="p">:</span>
                <span class="n">_c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PickedActor</span><span class="o">.</span><span class="n">GetCenter</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">geo_data</span><span class="o">.</span><span class="n">foliation_modify</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PickedProducer</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">_c</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Y</span><span class="o">=</span><span class="n">_c</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Z</span><span class="o">=</span><span class="n">_c</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">PickedProducer</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PickedActor</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">OnMiddleButtonUp</span><span class="p">()</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">na</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MiddleMouseButton released&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">PickedProducer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># print(&quot;Moving actor: &quot;,type(self.PickedActor))</span>
            <span class="c1"># print(&quot;Producer: &quot;,type(self.PickedProducer))</span>

            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PickedProducer</span><span class="p">)</span> <span class="ow">is</span> <span class="n">InterfaceSphere</span><span class="p">:</span>
                <span class="n">_c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PickedActor</span><span class="o">.</span><span class="n">GetCenter</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">geo_data</span><span class="o">.</span><span class="n">interface_modify</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PickedProducer</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">_c</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Y</span><span class="o">=</span><span class="n">_c</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Z</span><span class="o">=</span><span class="n">_c</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PickedProducer</span><span class="p">)</span> <span class="ow">is</span> <span class="n">CustomTransformPolyDataFilter</span><span class="p">:</span>
                <span class="n">_c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PickedActor</span><span class="o">.</span><span class="n">GetCenter</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">geo_data</span><span class="o">.</span><span class="n">foliation_modify</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PickedProducer</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">_c</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Y</span><span class="o">=</span><span class="n">_c</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Z</span><span class="o">=</span><span class="n">_c</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">PickedProducer</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PickedActor</span> <span class="o">=</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="CustomInteractorCamera"><a class="viewcode-back" href="../code.html#visualization_vtk.CustomInteractorCamera">[docs]</a><span class="k">class</span> <span class="nc">CustomInteractorCamera</span><span class="p">(</span><span class="n">vtk</span><span class="o">.</span><span class="n">vtkInteractorStyleTrackballCamera</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Custom camera interactor class.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ren_list</span><span class="p">,</span> <span class="n">geo_data</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">pot_field</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span><span class="s2">&quot;LeftButtonPressEvent&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_button_press_event</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span><span class="s2">&quot;LeftButtonReleaseEvent&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_button_release_event</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span><span class="s2">&quot;MouseMoveEvent&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouse_move_event</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span><span class="s2">&quot;KeyPressEvent&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_down_event</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">renwin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">GetRenderWindow</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ren_list</span> <span class="o">=</span> <span class="n">ren_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">geo_data</span> <span class="o">=</span> <span class="n">geo_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev_mouse_pos</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">left_button_hold</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pot_field</span> <span class="o">=</span> <span class="n">pot_field</span>

    <span class="k">def</span> <span class="nf">key_down_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">ev</span><span class="p">):</span>
        <span class="n">iren</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetInteractor</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">iren</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">key</span> <span class="o">=</span> <span class="n">iren</span><span class="o">.</span><span class="n">GetKeyCode</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;5&quot;</span><span class="p">:</span>  <span class="c1"># switch to other renderer</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pot_field</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">SetInteractorStyle</span><span class="p">(</span><span class="n">CustomInteractorActor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ren_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geo_data</span><span class="p">,</span>
                                                                     <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">))</span>
        <span class="c1"># elif key ==&quot;6&quot;:</span>
        <span class="c1">#     print(&quot;viewup:&quot;,self.ren_list[0].GetActiveCamera().GetViewUp())</span>
        <span class="c1">#     print(&quot;roll:&quot;,self.ren_list[0].GetActiveCamera().GetRoll())</span>
        <span class="c1">#elif key == &quot;7&quot;:</span>
        <span class="c1">#    self.renwin.Finalize()</span>
        <span class="c1">#    self.parent.TerminateApp()</span>
        <span class="c1">#    del self.renwin, self.parent</span>
        <span class="c1">#    # vtk.vtkRenderWindowInteractor</span>

    <span class="k">def</span> <span class="nf">left_button_press_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">ev</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">renwin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">renwin_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">renwin</span><span class="o">.</span><span class="n">GetSize</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">renwin_size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">800</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">left_button_hold</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">click_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetInteractor</span><span class="p">()</span><span class="o">.</span><span class="n">GetEventPosition</span><span class="p">()</span>
        <span class="c1"># self.parent.SetCurrentRenderer(self.ren_list[0])</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">click_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">renwin_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.66</span><span class="p">:</span>  <span class="c1"># self.renwin.GetSize()[0]*0.66:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">OnLeftButtonDown</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">left_button_release_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">ev</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">left_button_hold</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">OnLeftButtonUp</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">mouse_move_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">ev</span><span class="p">):</span>
        <span class="n">mouse_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetInteractor</span><span class="p">()</span><span class="o">.</span><span class="n">GetEventPosition</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">renwin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">renwin_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">renwin</span><span class="o">.</span><span class="n">GetSize</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">renwin_size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">800</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev_mouse_pos</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="n">mouse_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev_mouse_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">mouse_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">dx</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">renwin_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.66</span><span class="p">:</span>  <span class="c1"># self.renwin.GetSize()[0]*0.66:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">left_button_release_event</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">ev</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">OnMouseMove</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev_mouse_pos</span> <span class="o">=</span> <span class="n">mouse_pos</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="../index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Welcome to GeMpy’s documentation!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Kriging.html">Kriging structure of the <em>Potential field method</em></a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../code.html">Code</a></li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Miguel de la Varga, CGR-Aachen Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
    </div>

    

    
  </body>
</html>